<project name="opensiddur" default="dist" basedir=".">
	<description>
        Build file for opensiddur
    </description>
    <property name="lib.dir" location="lib"/>
    <property name="dist" location="dist"/>

    <include file="opensiddur-server/build.xml" as="server"/>
    <include file="opensiddur-tests/build.xml" as="tests"/>    

	<target name="init">
		<!-- Create the time stamp -->
		<tstamp/>
		<!-- do git submodule init, update -->
		<exec executable="git">
		    <arg value="submodule"/>
		    <arg value="init"/>
		</exec>
		<exec executable="git">
		    <arg value="submodule"/>
		    <arg value="update"/>
		</exec>
        <!-- make build dirs -->
        <mkdir dir="${dist}"/>
	</target>

	<target name="exist" depends="init">
		<!-- ./build.sh installer -Dizpack.dir=$(IZPACK) -Dinclude.module.scheduler=true -Dinclude.feature.security.oauth=true -Dinclude.feature.security.openid=true -->
		<exec 
			executable="./build.sh" 
			dir="${lib.dir}/exist">
			<arg value="installer"/>
			<arg value="-Dizpack.dir=${izpack}"/>
			<arg value="-Dinclude.module.scheduler=true"/>
			<arg value="-Dinclude.feature.security.oauth=true"/>
			<arg value="-Dinclude.feature.security.openid=true"/>
		</exec>
	</target>
	
	<target name="exist-clean">
		<exec 
			executable="./build.sh" 
			dir="${lib.dir}/exist">
			<arg value="clean"/>
		</exec>
	</target>
    
    <target name="hebmorph-exist" depends="init">
        <ant antfile="build.xml" dir="${lib.dir}/hebmorph-exist" target="dist" inheritAll="false"/>
        <copy todir="${dist}" file="${lib.dir}/hebmorph-exist/dist/hebmorph-exist.xar">
        </copy>
    </target>
    
    <target name="hebmorph-exist-clean">
        <ant antfile="build.xml" dir="${lib.dir}/hebmorph-exist" target="clean" inheritAll="false"/>
    </target>
	
	<target name="dist" depends="init,hebmorph-exist,server.dist,tests.dist"
		description="build everything">
        <copy todir="${dist}">
            <fileset dir=".">
                <include name="*/dist/*.xar"/>
            </fileset>
        </copy>
    </target>

	<target name="clean"
        description="clean up" 
		depends="exist-clean,hebmorph-exist-clean,server.clean,tests.clean">
		<!-- Delete the ${build} and ${dist} directory trees -->
    	<delete dir="${dist}"/>
	</target>
</project>

